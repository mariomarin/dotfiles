# Zim framework management

# OS compatibility check
_check-os:
    #!/usr/bin/env nu
    if (sys | get host.name) == "Windows" {
        print "âŒ Error: Zim (Zsh framework) is only available on Unix-like systems"
        print "   Windows does not support Zsh natively. Consider using WSL for Zsh."
        exit 1
    }

# Default: update modules
default: _check-os update

# Install Zim
install: _check-os
    curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh

# Update Zim modules
update: _check-os
    zimfw update

# Uninstall Zim modules
uninstall: _check-os
    zimfw uninstall

# Upgrade Zim itself
upgrade: _check-os
    zimfw upgrade

# Clean Zim cache and compiled files
clean: _check-os
    zimfw clean
    zimfw clean-compiled

# Compile Zim modules for faster loading
compile: _check-os
    zimfw compile

# List installed modules
list: _check-os
    zimfw list

# Show Zim version
version: _check-os
    zimfw version

# Build custom completions
completions: _check-os
    #!/usr/bin/env bash
    echo "Regenerating custom completions..."
    for module in modules/*/init.zsh; do
        echo "Processing ${module}..."
        zsh -c "source ${module}"
    done

# Health check
health: _check-os
    #!/usr/bin/env bash
    echo "ðŸ” Zim Health Check"
    echo "=================="
    echo -n "âœ“ Zim installed: "; test -d ~/.zim && echo "yes" || echo "âŒ no"
    echo -n "âœ“ Zim version: "; zimfw version 2>/dev/null | head -1 || echo "not installed"
    echo -n "âœ“ Config file: "; test -f ~/.config/zim/zimrc && echo "exists" || echo "âŒ missing"
    echo -n "âœ“ Modules installed: "; ls ~/.zim/modules 2>/dev/null | wc -l | awk '{print $1 " modules"}' || echo "0 modules"
    echo -n "âœ“ Custom modules: "; ls modules 2>/dev/null | wc -l | awk '{print $1 " custom"}' || echo "0 custom"
    echo -n "âœ“ Compiled files: "; find ~/.zim -name "*.zwc" 2>/dev/null | wc -l | awk '{print $1 " files"}'
    echo -n "âœ“ Completion cache: "; ls ~/.cache/zim/compdump* 2>/dev/null | wc -l | awk '{print $1 " files"}' || echo "0 files"
    echo -n "âœ“ Zsh version: "; zsh --version | head -1
    echo ""

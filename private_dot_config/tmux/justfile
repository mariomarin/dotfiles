# Tmux configuration management

# OS compatibility check
_check-os:
    #!/usr/bin/env nu
    if (sys | get host.name) == "Windows" {
        print "âŒ Error: Tmux is only available on Unix-like systems (Linux, macOS)"
        print "   Windows does not support tmux. Consider using Windows Terminal with WSL instead."
        exit 1
    }

# Default: reload config
default: _check-os reload

# Reload tmux configuration
reload: _check-os
    tmux source-file ~/.config/tmux/tmux.conf ; tmux display-message "Config reloaded!"

# Install TPM plugins
plugins-install: _check-os
    ~/.local/share/tmux/plugins/tpm/bin/install_plugins

# Update TPM plugins
plugins-update: _check-os
    ~/.local/share/tmux/plugins/tpm/bin/update_plugins all

# Clean unused plugins
plugins-clean: _check-os
    ~/.local/share/tmux/plugins/tpm/bin/clean_plugins

# Show tmux status
status: _check-os
    #!/usr/bin/env bash
    tmux list-sessions 2>/dev/null || echo "No tmux sessions running"
    tmux list-windows 2>/dev/null || true
    tmux list-panes 2>/dev/null || true

# Kill tmux server
kill-server: _check-os
    tmux kill-server

# Health check
health: _check-os
    #!/usr/bin/env bash
    echo "ðŸ” Tmux Health Check"
    echo "=================="
    echo -n "âœ“ Tmux version: "; tmux -V
    echo -n "âœ“ Config file: "; test -f ~/.config/tmux/tmux.conf && echo "exists" || echo "âŒ missing"
    echo -n "âœ“ TPM installed: "; test -d ~/.local/share/tmux/plugins/tpm && echo "yes" || echo "âŒ no"
    echo -n "âœ“ Plugins installed: "; ls ~/.local/share/tmux/plugins 2>/dev/null | wc -l | awk '{print $1 " plugins"}'
    echo -n "âœ“ Server running: "; tmux list-sessions &>/dev/null && echo "yes" || echo "no"
    echo -n "âœ“ Sessions: "; tmux list-sessions 2>/dev/null | wc -l | awk '{print $1 " active"}' || echo "0 active"
    echo -n "âœ“ Key bindings: "; tmux list-keys | wc -l | awk '{print $1 " configured"}'
    echo -n "âœ“ Environment: "; tmux show-environment TERM 2>/dev/null | cut -d= -f2 || echo "not in tmux"
    echo ""

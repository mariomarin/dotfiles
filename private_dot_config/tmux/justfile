# Tmux configuration management
# Plugins managed by nix (see nix/common/modules/cli-tools.nix)

set shell := ["nu", "-c"]

# Default: reload config
default: reload

# Reload tmux configuration
reload:
    tmux source-file ~/.config/tmux/tmux.conf ; tmux display-message "Config reloaded!"

# Show tmux status
status:
    #!/usr/bin/env nu
    let sessions = (do { tmux list-sessions } | complete)
    if $sessions.exit_code != 0 {
        print "No tmux sessions running"
    } else {
        print $sessions.stdout
        (do { tmux list-windows } | complete | get stdout)
        (do { tmux list-panes } | complete | get stdout)
    }

# Kill tmux server
kill-server:
    tmux kill-server

# Health check
health:
    #!/usr/bin/env nu
    print "üîç Tmux Health Check"
    print "=================="
    let version_result = (do { tmux -V } | complete)
    let version = if $version_result.exit_code == 0 { $version_result.stdout | str trim } else { "unknown" }
    print $"‚úì Tmux version: ($version)"
    let config_exists = ("~/.config/tmux/tmux.conf" | path expand | path exists)
    print $"‚úì Config file: (if $config_exists { 'exists' } else { '‚ùå missing' })"
    let plugins_dir = "/run/current-system/sw/share/tmux-plugins"
    let plugins = if ($plugins_dir | path exists) { (ls $plugins_dir | length) } else { 0 }
    print $"‚úì Nix plugins: ($plugins) installed"
    let server_result = (do { tmux list-sessions } | complete)
    let server_running = if $server_result.exit_code == 0 { "yes" } else { "no" }
    print $"‚úì Server running: ($server_running)"
    let sessions = if $server_result.exit_code == 0 { ($server_result.stdout | lines | length) } else { 0 }
    print $"‚úì Sessions: ($sessions) active"
    let keys_result = (do { tmux list-keys } | complete)
    let keys = if $keys_result.exit_code == 0 { ($keys_result.stdout | lines | length) } else { 0 }
    print $"‚úì Key bindings: ($keys) configured"
    let env_result = (do { tmux show-environment TERM } | complete)
    let term = if $env_result.exit_code == 0 { ($env_result.stdout | split row '=' | last | str trim) } else { "not in tmux" }
    print $"‚úì Environment: ($term)"
    print ""

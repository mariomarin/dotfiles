# Nushell Vi Mode Configuration

This configuration provides vi mode functionality in Nushell, attempting to match zsh-vi-mode capabilities where possible.

## Quick Reference

### Insert Mode

| Key | Action |
|-----|--------|
| `ESC` or `Ctrl+[` | Normal mode |
| `Ctrl+A` | Beginning of line |
| `Ctrl+E` | End of line |
| `Ctrl+K` | Kill to end |
| `Ctrl+U` | Kill to start |
| `Ctrl+W` | Delete word back |
| `Ctrl+R` | History search |
| `Tab` | Completion |

### Normal Mode

| Key | Action |
|-----|--------|
| `i/I/a/A` | Insert modes |
| `h/j/k/l` | Navigation |
| `w/W/b/B/e/E` | Word motions |
| `0/$` | Line start/end |
| `f/F/t/T` | Find char |
| `d/c/y` | Operators |
| `dd/cc/yy` | Line operations |
| `p/P` | Paste |
| `u` | Undo |
| `Ctrl+R` | Redo |
| `v` | Visual mode |
| `/` | History search |

### Visual Mode

| Key | Action |
|-----|--------|
| `d/x` | Delete selection |
| `c/s` | Change selection |
| `y` | Yank selection |
| `ESC` | Exit visual |

## Features

✅ **Working:**

- Vi mode with insert/normal/visual modes
- Cursor shapes per mode (line for insert, block for normal)
- Core vi motions and operators
- Visual mode (fixed in Nushell 0.104+)
- Ctrl-based emacs-style shortcuts in insert mode
- History search (Ctrl+R)
- Tab completion
- Oh-My-Posh prompt integration

⚠️ **Limited:**

- Dot repeat (basic only, not full vim behavior)
- External editor fallback (`Ctrl+X Ctrl+E` or `v` in normal mode)

❌ **Not Available:**

- jk/jj escape sequences (Reedline supports it, config exposure pending)
- Text objects (diw, ciw, daw, etc.)
- Surround operations (cs, ds, ys)
- Keyword switching (Ctrl+A/Ctrl+X for numbers)

## External Editor Workaround

For complex edits requiring text objects or surrounds, press:

- `Ctrl+X Ctrl+E` (from any mode)
- `v` (from normal mode)

This opens Neovim (configured in `config.nu`) with full vim functionality.

## Oh-My-Posh Prompt

The configuration uses Oh-My-Posh for a modern prompt. The prompt theme is configured in `env.nu`:

```nu
$env.POSH_THEME = ~/.config/oh-my-posh/themes/catppuccin_mocha.omp.json
```

You can change themes by modifying this path or using the `oh-my-posh` CLI.

## External Tool Integration

The configuration automatically detects and integrates these tools if installed:

- **Atuin**: Enhanced history with sync and search
- **Zoxide**: Smart directory navigation (z command)
- **Carapace**: Multi-command completions

## Validation

Test your configuration:

```nu
# Check edit mode
$env.config.edit_mode

# List vi keybindings
keybindings list | where mode =~ 'vi'

# Test cursor changes
# Type text, press ESC, observe cursor change from line to block
```

## Files

- `~/.config/nushell/config.nu` - Main configuration
- `~/.config/nushell/env.nu` - Environment and Oh-My-Posh setup
- `~/.config/nushell/oh-my-posh.nu` - Generated by Oh-My-Posh
- `~/.config/nushell/atuin.nu` - Generated by Atuin (if installed)
- `~/.config/nushell/zoxide.nu` - Generated by Zoxide (if installed)

## Differences from zsh-vi-mode

Due to Reedline (Nushell's line editor) architecture:

1. **No jk escape**: Use `ESC` or `Ctrl+[` instead
2. **No text objects**: Use `b`/`e`/`w` with operators or external editor
3. **No surrounds**: Use external editor
4. **Limited dot repeat**: Only for simple edits
5. **No keyword switching**: Manual editing required

For workflows heavily dependent on these features, consider using the external editor integration.

## Related Documentation

- [Nushell Book](https://www.nushell.sh/book/)
- [Reedline Documentation](https://github.com/nushell/reedline)
- [Oh-My-Posh](https://ohmyposh.dev/)

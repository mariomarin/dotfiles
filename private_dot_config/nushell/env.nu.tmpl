# Nushell Environment Config File
#
# version = "0.104.0"

# Specifies how environment variables are:
# - converted from a string to a value on Nushell startup (from_string)
# - converted from a value back to a string when running external commands (to_string)
$env.ENV_CONVERSIONS = {
    "PATH": {
        from_string: { |s| $s | split row (char esep) | path expand --no-symlink }
        to_string: { |v| $v | path expand --no-symlink | str join (char esep) }
    }
    "Path": {
        from_string: { |s| $s | split row (char esep) | path expand --no-symlink }
        to_string: { |v| $v | path expand --no-symlink | str join (char esep) }
    }
}

# -----------------------------------------------------------------------------
# NUPM (Nushell Package Manager) CONFIGURATION
# -----------------------------------------------------------------------------
{{- if eq .chezmoi.os "windows" }}
$env.NUPM_HOME = ($env.USERPROFILE | path join '.local' 'share' 'nupm')
{{- else }}
$env.NUPM_HOME = ($env.HOME | path join '.local' 'share' 'nupm')
{{- end }}

# Directories to search for scripts when calling source or use
$env.NU_LIB_DIRS = [
    ($nu.default-config-dir | path join 'scripts')
    ($nu.default-config-dir | path join 'modules')
    ($nu.data-dir | path join 'completions')
    ($env.NUPM_HOME | path join 'nupm')  # Fixed: nupm module is at nupm/nupm/ not nupm/modules/
    ($env.NUPM_HOME | path join 'modules')
]

# Directories to search for plugin binaries when calling register
$env.NU_PLUGIN_DIRS = [
    ($nu.default-config-dir | path join 'plugins')
]

# -----------------------------------------------------------------------------
# PATH CONFIGURATION
# -----------------------------------------------------------------------------
{{- if eq .chezmoi.os "windows" }}
# Windows PATH
$env.Path = (
    $env.Path
    | split row (char esep)
    | append ($env.USERPROFILE | path join '.local' 'bin')
    | append ($env.USERPROFILE | path join 'go' 'bin')
    | append ($env.NUPM_HOME | path join 'scripts')
    | uniq
)
{{- else }}
# Unix PATH
$env.PATH = (
    $env.PATH
    | split row (char esep)
    | prepend ($env.HOME | path join '.local' 'bin')
    | prepend ($env.HOME | path join 'go' 'bin')
    | prepend ($env.NUPM_HOME | path join 'scripts')
{{- if eq .chezmoi.os "darwin" }}
    | prepend '/opt/homebrew/bin'
    | prepend '/usr/local/bin'
{{- end }}
    | uniq
)
{{- end }}

# -----------------------------------------------------------------------------
# OH-MY-POSH PROMPT
# -----------------------------------------------------------------------------
{{- if eq .chezmoi.os "windows" }}
# Windows: oh-my-posh integration
if (which oh-my-posh | is-not-empty) {
    $env.POSH_THEME = ($env.USERPROFILE | path join '.config' 'oh-my-posh' 'themes' 'catppuccin_mocha.omp.json')
    oh-my-posh init nu --config $env.POSH_THEME | save --force ($nu.default-config-dir | path join 'oh-my-posh.nu')
}
{{- else }}
# Unix: oh-my-posh integration
if (which oh-my-posh | is-not-empty) {
    $env.POSH_THEME = ($env.HOME | path join '.config' 'oh-my-posh' 'themes' 'catppuccin_mocha.omp.json')
    oh-my-posh init nu --config $env.POSH_THEME | save --force ($nu.default-config-dir | path join 'oh-my-posh.nu')
}
{{- end }}

# -----------------------------------------------------------------------------
# ADDITIONAL ENVIRONMENT VARIABLES
# -----------------------------------------------------------------------------
$env.EDITOR = 'nvim'
$env.VISUAL = 'nvim'

{{- if eq .chezmoi.os "linux" }}
# Linux-specific
$env.BROWSER = 'firefox'
{{- else if eq .chezmoi.os "darwin" }}
# macOS-specific
$env.BROWSER = 'open'
{{- end }}

{{- if .machineConfig.features.desktop -}}#!/usr/bin/env bash
export SCRIPTPATH

SCRIPTPATH="$(dirname "$(readlink -f "$0")")"

# Down the last running theme
[ -f "/tmp/leftwm-theme-down" ] && /tmp/leftwm-theme-down && rm /tmp/leftwm-theme-down
ln -s "$SCRIPTPATH/down" "/tmp/leftwm-theme-down"

# Load theme settings
leftwm-command "LoadTheme $SCRIPTPATH/theme.ron"

# Set initial wallpaper using feh (systemd timer handles rotation)
if [ -d "$HOME/.wallpapers" ] && [ "$(ls -A "$HOME/.wallpapers" 2>/dev/null)" ]; then
    feh --bg-fill --randomize "$HOME/.wallpapers"/* >/dev/null 2>&1
fi

# Start services via systemd
systemctl --user start picom.service
systemctl --user start polybar.service
{{- end -}}
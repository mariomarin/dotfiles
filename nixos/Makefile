# NixOS rebuild commands
.PHONY: switch test boot build health

switch:
	sudo nixos-rebuild switch --flake .#nixos

test:
	sudo nixos-rebuild test --flake .#nixos

boot:
	sudo nixos-rebuild boot --flake .#nixos

build:
	sudo nixos-rebuild build --flake .#nixos

# Flake management
update:
	nix flake update

check:
	nix flake check

show:
	nix flake show

# Health check
health:
	@echo "ðŸ” NixOS Health Check"
	@echo "===================="
	@echo -n "âœ“ NixOS version: "; nixos-version
	@echo -n "âœ“ Current generation: "; sudo nix-env --list-generations --profile /nix/var/nix/profiles/system | tail -1
	@echo -n "âœ“ Flake status: "; test -f flake.lock && echo "locked" || echo "âš ï¸  not locked"
	@echo -n "âœ“ Configuration syntax: "; nix-instantiate --parse configuration.nix > /dev/null 2>&1 && echo "valid" || echo "âŒ invalid"
	@echo -n "âœ“ Flake check: "; nix flake check --no-build 2>/dev/null && echo "passed" || echo "âš ï¸  warnings"
	@echo -n "âœ“ Nix daemon: "; systemctl is-active nix-daemon.service || echo "not running"
	@echo -n "âœ“ Disk usage: "; du -sh /nix/store 2>/dev/null | cut -f1
	@echo ""

# Default target
all: switch
#!/usr/bin/env bash
# Setup autorandr for automatic display configuration

set -euo pipefail

{{- if .machineConfig.features.desktop }}
echo "Setting up autorandr..."

# Create initial profile if displays are connected
if command -v autorandr >/dev/null 2>&1; then
    # Save current configuration as 'default'
    if ! autorandr | grep -q "default (current)"; then
        echo "Saving current display configuration as 'default' profile..."
        autorandr --save default || true
    fi
    
    # Detect connected displays
    autorandr --change
    
    echo "✓ Autorandr configured"
    echo "  - Current profiles: $(autorandr | grep -v "(current)" | xargs)"
    echo "  - Save new profile: autorandr --save PROFILE_NAME"
    echo "  - Switch profile: autorandr PROFILE_NAME"
else
    echo "⚠ Autorandr not found. Install it and re-run chezmoi apply"
fi
{{- else }}
echo "Skipping autorandr setup on non-desktop machine"
{{- end }}
#!/usr/bin/env nu
# Reload kanata when config changes
# darwin.kbd hash: {{ include "private_dot_config/kanata/darwin.kbd" | sha256sum }}
# laptop.kbd hash: {{ include "private_dot_config/kanata/laptop.kbd" | sha256sum }}

let os = (^uname -s | str trim | str downcase)

match $os {
    "darwin" => {
        print "Reloading kanata (macOS)..."
        if (do { sudo launchctl list | grep "org.nixos.kanata" } | complete).exit_code == 0 {
            sudo launchctl stop org.nixos.kanata
            sleep 1sec
            sudo launchctl start org.nixos.kanata
            print "Kanata reloaded"
        } else {
            print "Kanata service not found, skipping"
        }
    }
    "linux" => {
        print "Reloading kanata (Linux)..."
        if (systemctl is-active kanata-laptop | complete).exit_code == 0 {
            sudo systemctl restart kanata-laptop
            print "Kanata reloaded"
        } else {
            print "Kanata service not active, skipping"
        }
    }
    _ => {
        print $"Unknown OS: ($os), skipping kanata reload"
    }
}

#!/usr/bin/env nu
# Install packages from .chezmoidata/packages.yaml (Windows)
# This script runs when the package list or script content changes

print "üì¶ Installing packages for Windows..."

# Check if winget is installed
if (which winget | is-empty) {
    print "‚ùå winget not found. Please install App Installer from Microsoft Store."
    exit 1
}

# Install winget packages
{{- range .packages.windows.winget }}
print $"  Checking {{ . }}..."
let installed = (winget list --id "{{ . }}" --exact | complete)
if ($installed.stdout | str contains "{{ . }}") {
    print "  ‚úì {{ . }} already installed"
} else {
    print $"  Installing {{ . }}..."
    winget install --id "{{ . }}" --exact --silent --accept-package-agreements --accept-source-agreements
}
{{- end }}

print "‚úÖ Packages installed successfully"

{{- if eq .chezmoi.os "windows" -}}
#!/usr/bin/env nu
# Reload kanata when config changes (Windows)
# windows.kbd hash: {{ include "private_dot_config/kanata/windows.kbd" | sha256sum }}

print "Reloading kanata (Windows)..."

# Windows: kanata typically runs as a background process or scheduled task
# Try to restart it via taskkill and starting again
let kanata_running = (do { tasklist | find "kanata" } | complete).exit_code == 0

if $kanata_running {
    print "Stopping kanata..."
    taskkill /IM kanata.exe /F | ignore
    sleep 1sec
    # Start kanata in background - adjust path as needed
    let kanata_path = ($env.LOCALAPPDATA | path join "kanata" "kanata.exe")
    let config_path = ($env.USERPROFILE | path join ".config" "kanata" "windows.kbd")
    if ($kanata_path | path exists) {
        print "Starting kanata..."
        ^$kanata_path --cfg $config_path &
        print "Kanata reloaded"
    } else {
        print "Kanata executable not found, skipping start"
    }
} else {
    print "Kanata not running, skipping"
}
{{- end }}

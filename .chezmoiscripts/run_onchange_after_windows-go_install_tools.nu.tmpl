#!/usr/bin/env nu
# Install Go tools from source (Windows)
# This script runs when goTools entries in .chezmoidata.toml change
# Note: container-use is not available for Windows

# Check if Go is installed
if (which go | is-empty) {
    print "⚠️  Go not installed, skipping Go tools installation"
    exit 0
}

{{- range .goTools }}
{{- if ne .binary "container-use" }}
print "Installing {{ .binary }}@{{ .version }} from source..."
go install "{{ .module }}@{{ .version }}"
{{- end }}
{{- end }}

# Verify installations using full path
let go_bin = $"($env.USERPROFILE)\\go\\bin"
with-env {PATH: ($env.PATH | prepend $go_bin)} {
{{- range .goTools }}
{{- if ne .binary "container-use" }}
    {{ .binary }} version | ignore
{{- end }}
{{- end }}
}

print "✅ All Go tools installed successfully"
